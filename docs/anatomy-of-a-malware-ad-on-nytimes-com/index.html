<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Anatomy of a malware ad on NYTimes.com %mdash; Troy Davis</title>

    <meta name="description" content="Seattle. Everything is an experiment.">  

    <link rel="stylesheet" href="/assets/css/main.css?1669059588151907000">

    <script>
if(!(window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-7603079-1', 'auto');
  ga('send', 'pageview');
}
</script>    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap" rel="stylesheet">

    <link href="/images/favicon.png" rel="icon">

    <link type="application/atom+xml" rel="alternate" href="/feed" title="Troy Davis" />
</head>
  <body>

    
    

    
  




  <nav class="site-navigation" role="navigation">
    <ul>
      <li>
        <a href="/">
          Home
        </a>
      </li>
    
    
      <li >
        
          <a href="https://twitter.com/troyd">
            I'm @troyd on Twitter
          </a>
        
      </li>
    
      <li >
        
          <a href="/feed">
            RSS
          </a>
        
      </li>
    
    </ul>
  </nav>




<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting" id="main" role="article" aria-label="Content">

  
    <h1 class="post-title divided p-name" itemprop="name headline">
      Anatomy of a malware ad on NYTimes.com
    </h1>
  

  <div class="post-content e-content" itemprop="articleBody">
    <p>On Saturday evening, Avast displayed a malware warning as I loaded a nytimes.com article. After some digging, here’s the malware I found.</p>

<h3 id="ad-delivery">Ad Delivery</h3>

<p>nytimes.com article pages include an ad placement with the HTML DOM ID <code class="language-plaintext highlighter-rouge">adxBigAd</code>. From loading a few articles, they seem to rotate between a banner and an iframe. On this article, a 300x250 iframe was inlining this URL: <code class="language-plaintext highlighter-rouge">tradenton.com</code> slash <code class="language-plaintext highlighter-rouge">?id=21610438</code> (note: I don’t recommend visiting it, and URLs are not linked where possible).</p>

<p>A comment gave the campaign ID as <code class="language-plaintext highlighter-rouge">Vonage01_1163613_nyt12</code>, though it was obviously unrelated to Vonage. tradenton.com was registered Sept. 2, 2009, so it may have had a previous owner.</p>

<h3 id="injection">Injection</h3>

<p>tradenton.com serves a 15-line HTML snipped containing this JavaScript:</p>

<script src="https://gist.github.com/troy/186462.js"></script>

<p>As anyone who has looked at phishing links knows, this is nasty on a couple levels. It’s <code class="language-plaintext highlighter-rouge">eval()</code>‘ing escaped code, which is almost never needed to serve an ad. Note that the variable <code class="language-plaintext highlighter-rouge">action_URL</code> is defined but never used. After unescaping the code, this is what’s being run:</p>

<script src="https://gist.github.com/troy/186464.js"></script>

<p>What’s served by <code class="language-plaintext highlighter-rouge">harlingens.com</code> slash <code class="language-plaintext highlighter-rouge">includes02.js</code>? Aha! The eval’ed JavaScript is requesting a second Javascript, which hits <code class="language-plaintext highlighter-rouge">action_URL</code>:</p>

<script src="https://gist.github.com/troy/186466.js"></script>

<h3 id="malware">Malware</h3>

<p>Now we’re talking. Requesting that <code class="language-plaintext highlighter-rouge">action_UR</code> on <code class="language-plaintext highlighter-rouge">sex-and-the-city.cn</code> actually serves a HTTP 302 Redirect to <code class="language-plaintext highlighter-rouge">protection-check07.com</code> slash <code class="language-plaintext highlighter-rouge">1/?sess=%3DGQx3jzwMi02MyZpcD0yMDguNzUuNTcuMTIxJnRpbWU9MTI1NjgwMI0MaQ%3DN</code>. And we hit pay dirt. It’s a fake page for a non-existent antivirus app, which is actually malware. Titled “My computer Online Scan”, this page displays this JS alert:</p>

<p><img src="http://images.yort.com/blog/nytimes-malware-1.jpg" alt="Popup from malware advertised on nytimes.com" /></p>

<p>Then resizes the browser window into a full-screen application-style, as if it had become a virus scanner. Some highlights from the static content and JS on this page:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Dont close this window, if your want you PC to be protected.
353 trojans
You need to remove this threat as soon as possible!
Scan procedures finished.
431 Probably harmfull items was found!
</code></pre></div></div>

<p>Here’s a screen shot:</p>

<p><img src="http://images.yort.com/blog/nytimes-malware-2.jpg" alt="screenshot of web page of malware advertised on nytimes.com" /></p>

<p>Here’s <a href="https://gist.github.com/troy/186467">full HTML source</a> in a gist viewer. As usual, these phishers haven’t sprung for spelling or grammar checkers.</p>

<p>The page also uses IP-based geocoding by inlining its own iframe called <code class="language-plaintext highlighter-rouge">geoip.php</code>, which has city-level granularity (though it was off by 1,000 miles for me). The “Full System Cleanup” link goes to <code class="language-plaintext highlighter-rouge">/download.php?id=2006-63</code> on the same server, which serves a file called <code class="language-plaintext highlighter-rouge">Scanner-b4ba2_2006-63.exe</code>.</p>

<p>That redirects to <code class="language-plaintext highlighter-rouge">/download/Scanner-b4ba2_2006-63.exe</code>, a static file with the checksum <code class="language-plaintext highlighter-rouge">6c5b5669151337ca51ec45b1f5785d02</code>. Running strings on this 167 KB program - too small for any virus scanner - has it requesting administrator privileges, though I haven’t done detailed forensics.</p>

<h3 id="notes">Notes</h3>

<p>As of Sept. 12, 2009, <code class="language-plaintext highlighter-rouge">tradenton.com</code> and <code class="language-plaintext highlighter-rouge">harlingens.com</code> resolved to 212.117.166.69. <code class="language-plaintext highlighter-rouge">sex-and-the-city.cn</code> resolved to 94.102.48.29. <code class="language-plaintext highlighter-rouge">protection-check07.com</code> had 3 A records: 91.212.107.5, 94.102.51.26, 88.198.107.25. Also, I changed indentation and spacing for readability, so checksums on gist may not match source files.</p>

  </div>

  <div class="post-meta">
    
    <time class="post-date dt-published" datetime="2009-09-13T00:00:00-07:00" itemprop="datePublished">September 13, 2009</time>
  </div>

  

</article>


    

    




  <nav class="site-navigation" role="navigation">
    <ul>
      <li>
        <a href="/">
          Home
        </a>
      </li>
    
    
      <li >
        
          <a href="https://twitter.com/troyd">
            I'm @troyd on Twitter
          </a>
        
      </li>
    
      <li >
        
          <a href="/feed">
            RSS
          </a>
        
      </li>
    
    </ul>
  </nav>


    




  <nav class="site-navigation" role="navigation">
    <ul>
      <li>
        <a href="/">
          Home
        </a>
      </li>
    
    
      <li >
        
          <a href="https://seattleapproves.org/">
            Seattle Approves
          </a>
        
      </li>
    
      <li >
        
          <a href="https://simpleoptout.com/">
            Simple Opt Out
          </a>
        
      </li>
    
      <li >
        
          <a href="https://tacoapp.com/">
            Taco
          </a>
        
      </li>
    
      <li >
        
          <a href="http://sawsafely.org/">
            Saw Safely
          </a>
        
      </li>
    
    </ul>
  </nav>



    

  </body>
</html>
